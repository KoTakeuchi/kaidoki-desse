{% extends "base.html" %}
{% load static %}
{% block title %}é€šçŸ¥è¨­å®š{% endblock %}

{% block content %}
<div class="card shadow-sm p-4 mb-4">
    <h5 class="mb-3">ğŸ”” é€šçŸ¥è¨­å®š</h5>

    <!-- âœ… ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º -->
    {% if messages %}
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} mb-3">{{ message }}</div>
    {% endfor %}
    {% endif %}

    <!-- âœ… ãƒ•ã‚©ãƒ¼ãƒ ã‚¨ãƒ©ãƒ¼å…¨ä½“è¡¨ç¤º -->
    {% if form.non_field_errors %}
    <div class="alert alert-danger mb-3">
        {% for error in form.non_field_errors %}
        âš ï¸ {{ error }}<br>
        {% endfor %}
    </div>
    {% endif %}

    <form method="post" novalidate>
        {% csrf_token %}

        <!-- âœ… ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ -->
        <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" id="id_enabled" name="enabled" {% if form.instance.enabled %}checked{% endif %}>
            <label class="form-check-label fw-semibold" for="id_enabled">
                ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚’æœ‰åŠ¹ã«ã™ã‚‹
            </label>
            <div class="form-text text-muted">
                â€»å„ªå…ˆåº¦ã€Œé«˜ã€ã®å•†å“ã®ã¿é€šçŸ¥å¯¾è±¡ã§ã™ã€‚
            </div>
        </div>

        <!-- âœ… ãƒ¡ãƒ¼ãƒ«é€šçŸ¥æ™‚åˆ»è¨­å®š -->
        <div id="email-notify-time" class="row mb-3">
            <div class="col-auto">
                {{ form.notify_hour.label_tag }}
                {{ form.notify_hour }}
                {% for error in form.notify_hour.errors %}
                <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>
            <div class="col-auto">
                {{ form.notify_minute.label_tag }}
                {{ form.notify_minute }}
                {% for error in form.notify_minute.errors %}
                <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>
        </div>

        <!-- âœ… ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ç¢ºèª -->
        <div class="mb-4">
            {{ form.email.label_tag }}
            {{ form.email }}
            {% for error in form.email.errors %}
            <div class="text-danger small">{{ error }}</div>
            {% endfor %}
            <div class="form-text text-muted">
                â€»ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«é€šçŸ¥ãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚<br>
                â€»å¤‰æ›´ã—ãŸã„å ´åˆã¯ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ç·¨é›†ã€ãƒšãƒ¼ã‚¸ã‹ã‚‰ç™»éŒ²ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚
            </div>
        </div>

        <hr class="my-4">

        <!-- âœ… ã‚¢ãƒ—ãƒªå†…é€šçŸ¥è¨­å®š -->
        <h5 class="mb-3">ğŸ“± ã‚¢ãƒ—ãƒªå†…é€šçŸ¥è¨­å®š</h5>

        <!-- é€šçŸ¥é »åº¦ -->
        <div class="mb-3">
            {{ form.app_notify_frequency.label_tag }}
            {{ form.app_notify_frequency }}
            {% for error in form.app_notify_frequency.errors %}
            <div class="text-danger small">{{ error }}</div>
            {% endfor %}
            <div class="form-text text-muted">
                ã€Œå¤šã‚ã€ã¯è²·ã„æ™‚æ¤œçŸ¥ã®ãŸã³ã«é€šçŸ¥ã€ã€Œå°‘ãªã‚ã€ã¯æŒ‡å®šæ™‚åˆ»ã«1å›ã¾ã¨ã‚ã¦é€šçŸ¥ã•ã‚Œã¾ã™ã€‚
            </div>
        </div>

        <!-- é€šçŸ¥æ™‚åˆ» -->
        <div id="app-notify-time" class="row mb-4">
            <div class="col-auto">
                {{ form.app_notify_hour.label_tag }}
                {{ form.app_notify_hour }}
                {% for error in form.app_notify_hour.errors %}
                <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>
            <div class="col-auto">
                {{ form.app_notify_minute.label_tag }}
                {{ form.app_notify_minute }}
                {% for error in form.app_notify_minute.errors %}
                <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>
        </div>

        <!-- ä¿å­˜ãƒœã‚¿ãƒ³ -->
        <div class="mt-3">
            <button type="submit" class="btn btn-primary w-100">ä¿å­˜ã™ã‚‹</button>
        </div>
    </form>
</div>

<!-- âœ… ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚¤ãƒ¡ãƒ¼ã‚¸ -->
<div class="card shadow-sm p-4 mt-4">
    <h5 class="mb-3">ğŸ“© é€šçŸ¥ãƒ¡ãƒ¼ãƒ«ã®ã‚¤ãƒ¡ãƒ¼ã‚¸</h5>
    <div class="text-center">
        <img src="{% static 'images/not_sample_mail.png' %}" alt="é€šçŸ¥ãƒ¡ãƒ¼ãƒ«ä¾‹" class="img-fluid rounded shadow-sm" style="max-width:600px;">
        <p class="text-muted mt-2 small">
            â€» å®Ÿéš›ã®ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ï¼ˆä»¶åãƒ»æ—¥ä»˜ãƒ»å•†å“åãŒå·®ã—è¾¼ã¿è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰
        </p>
    </div>
</div>

<div class="mt-3 text-center">
    <a href="{% url 'main:product_list' %}" class="text-secondary">â† å•†å“ä¸€è¦§ã«æˆ»ã‚‹</a>
</div>

<!-- âœ… JSåˆ¶å¾¡ -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const emailToggle = document.getElementById("id_enabled");
    const emailTime = document.getElementById("email-notify-time");
    const appFrequency = document.getElementById("id_app_notify_frequency");
    const appTime = document.getElementById("app-notify-time");

    const updateVisibility = () => {
      emailTime.style.display = emailToggle.checked ? "flex" : "none";
      appTime.style.display = appFrequency.value === "daily" ? "flex" : "none";
    };

    emailToggle.addEventListener("change", updateVisibility);
    appFrequency.addEventListener("change", updateVisibility);

    updateVisibility();
  });
</script>
{% endblock %}
