{% extends "layout-user.html" %}
{% load static %}
{% block title %}{{ product.product_name }} の編集{% endblock %}

{% block page_content %}
<div class="page-header">
  <h1 class="page-title">
    <span class="title-inner">商品編集</span>
  </h1>
</div>

<div class="container py-4">
  <!-- 成功メッセージ -->
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-success text-center py-2 mb-4">{{ message }}</div>
    {% endfor %}
  {% endif %}

  <form method="post">
    {% csrf_token %}

    <!-- 商品情報カード -->
    <div class="card shadow-sm p-4 mb-4">
      <div class="row g-4">
        <!-- 左：画像 -->
        <div class="col-md-5 text-center">
          <img
            src="{% if product.image_url %}{{ product.image_url }}{% else %}{% static 'images/no_image.png' %}{% endif %}"
            alt="{{ product.product_name }}"
            class="img-fluid rounded"
            style="max-height: 400px; object-fit: contain; pointer-events: none;"
          >
        </div>

        <!-- 右：基本情報 -->
        <div class="col-md-7">
          <div class="mb-3">
            <label class="form-label fw-bold">商品名</label>
            {{ form.product_name }}
            <small class="text-muted d-block">※最大100文字（一覧では超過分を省略表示）</small>
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">ショップ名</label>
            {{ form.shop_name }}
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">カテゴリ</label>
            {{ form.category }}
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">優先度</label>
            {{ form.priority }}
          </div>
        </div>
      </div>
    </div>

    <!-- 通知条件カード -->
    <div class="card shadow-sm p-4 mb-4">
      <h5 class="mb-3">通知条件の設定</h5>

      <div class="mb-3">
        <label class="form-label fw-bold">通知タイプ</label>
        <input type="text" class="form-control" value="{{ product.get_flag_type_display }}" readonly>
      </div>

      {% if product.flag_type == 'threshold_price' %}
        <div class="mb-3">
          <label class="form-label fw-bold">買い時価格</label>
          {{ form.flag_value }} <span class="ms-1">円</span>
        </div>
      {% elif product.flag_type == 'percent_off' %}
        <div class="mb-3">
          <label class="form-label fw-bold">割引率</label>
          {{ form.flag_value }} <span class="ms-1">%</span>
        </div>
      {% elif product.flag_type == 'lowest_price' %}
        <div class="mb-3">
          <label class="form-label fw-bold">最安値</label>
          <input type="text" class="form-control" value="最安値は変更できません" readonly>
        </div>
      {% endif %}

      {% if form.flag_value.errors %}
        <div class="text-danger small">{{ form.flag_value.errors }}</div>
      {% endif %}

      <!-- 更新ボタン -->
      <div class="text-end mt-4">
        <button type="submit" class="btn btn-primary rounded-pill px-4"
          style="background-color: var(--primary); border: none;">
          更新
        </button>
      </div>
    </div>
  </form>

  <!-- 戻るボタン -->
  <div class="text-start mt-3">
    <a href="{% url 'main:product_list' %}" class="btn btn-outline-secondary rounded-pill px-4">
      ← 一覧へ戻る
    </a>
  </div>
</div>
{% endblock %}
