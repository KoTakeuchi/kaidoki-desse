{% extends "admin_app/layout-admin.html" %}
{% load static %}

{% block title %}Kaidoki Desse ç®¡ç† | ã‚¨ãƒ©ãƒ¼è©³ç´°{% endblock %}

{% block admin_content %}
<div class="container-fluid py-4" style="min-height: 80vh;">
  <h2 class="fw-bold mb-4 text-dark">ã‚¨ãƒ©ãƒ¼è©³ç´°</h2>

  <!-- ğŸ”¹ ä¸Šéƒ¨ï¼šã‚¨ãƒ©ãƒ¼è©³ç´°æƒ…å ± -->
  <div class="card shadow-sm mb-4" style="height: 55vh; overflow-y: auto;">
    <div class="card-body">
      <div class="row mb-2">
        <div class="col-md-6"><strong>ID</strong><br>{{ log.id }}</div>
        <div class="col-md-6"><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼å</strong><br>{{ log.user.username|default:"-" }}</div>
      </div>
      <div class="row mb-2">
        <div class="col-md-6"><strong>ç™ºç”Ÿç®‡æ‰€</strong><br>{{ log.source|default:"-" }}</div>
        <div class="col-md-6"><strong>ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥</strong><br>{{ log.type_name|default:"-" }}</div>
      </div>
      <div class="mb-3">
        <strong>å†…å®¹</strong><br>
        <pre class="p-3 bg-light border rounded" style="white-space: pre-wrap;">{{ log.message|default:"-" }}</pre>
      </div>
    </div>
  </div>

  <!-- ğŸ”¹ ä¸‹éƒ¨ï¼šå¯¾å¿œãƒ•ã‚©ãƒ¼ãƒ ï¼ˆã‚«ãƒ¼ãƒ‰ + ãƒœã‚¿ãƒ³å…¨éƒ¨ã¾ã¨ã‚ã¦ã²ã¨ã¤ã® formï¼‰ -->
  <form method="post">
    {% csrf_token %}

      <!-- ğŸ”¹ ä¸‹éƒ¨ï¼šå¯¾å¿œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ»ãƒ¡ãƒ¢ -->
      <div class="card shadow-sm mt-4" style="max-height: 40vh; overflow-y: auto;">
        <div class="card-body">
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label fw-semibold text-secondary">å¯¾å¿œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
              <select name="status" class="form-select">
                <option value="unresolved" {% if log.status == "unresolved" %}selected{% endif %}>æœªå¯¾å¿œ</option>
                <option value="in_progress" {% if log.status == "in_progress" %}selected{% endif %}>å¯¾å¿œä¸­</option>
                <option value="resolved" {% if log.status == "resolved" %}selected{% endif %}>å¯¾å¿œæ¸ˆã¿</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold text-secondary">å¯¾å¿œè€…</label>
              <select name="handled_by" class="form-select">
                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                {% for admin_user in admin_users %}
                  <option value="{{ admin_user.id }}" {% if log.handled_by and log.handled_by.id == admin_user.id %}selected{% endif %}>
                    {{ admin_user.username }}
                  </option>
                {% endfor %}
              </select>
            </div>
          </div>

          <div>
            <label class="form-label fw-semibold text-secondary">å¯¾å¿œãƒ¡ãƒ¢</label>
            <textarea name="response_memo" class="form-control" rows="6"
              style="resize: vertical; max-height: 200px; overflow-y: auto;">{{ log.response_memo|default:"" }}</textarea>
          </div>
        </div>
      </div>


    <!-- ãƒœã‚¿ãƒ³ã¯ã‚«ãƒ¼ãƒ‰ã®å¤–ã ã‘ã©åŒã˜ form å†… -->
    <div class="d-flex justify-content-between mt-2" style="padding: 0 0.25rem;">
      <a href="{% url 'admin_app:admin_error_logs' %}" class="btn text-white px-4" style="background-color:#6c757d;">
        æˆ»ã‚‹
      </a>
      <button type="submit" class="btn text-white px-4" style="background-color:#3CA9A9;">
        æ›´æ–°
      </button>
    </div>
  </form>
</div>
{% endblock %}
