{% extends "admin_app/layout-admin.html" %}
{% load static %}

{% block title %}Kaidoki Desse ç®¡ç† | ã‚¨ãƒ©ãƒ¼ç®¡ç†{% endblock %}

{% block admin_content %}
<div class="container-fluid py-4">
  <h2 class="fw-bold mb-4 text-dark">ã‚¨ãƒ©ãƒ¼ç®¡ç†</h2>

  <!-- ğŸ” æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
  <form method="get" class="d-flex align-items-end justify-content-between flex-wrap mb-4" style="gap: 8px;">
    <div style="width: 22%;">
      <label class="form-label fw-semibold text-secondary">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
      <input type="text" name="q" value="{{ request.GET.q }}" class="form-control" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒ»ç™ºç”Ÿç®‡æ‰€ãƒ»å†…å®¹">
    </div>

    <div style="width: 12%;">
      <label class="form-label fw-semibold text-secondary">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
      <select name="status" class="form-select">
        <option value="">å…¨ã¦</option>
        <option value="resolved" {% if request.GET.status == "resolved" %}selected{% endif %}>å¯¾å¿œæ¸ˆ</option>
        <option value="unresolved" {% if request.GET.status == "unresolved" %}selected{% endif %}>æœªå¯¾å¿œ</option>
      </select>
    </div>

    <div style="width: 12%;">
      <label class="form-label fw-semibold text-secondary">ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥</label>
      <select name="type" class="form-select">
        <option value="">å…¨ã¦</option>
        <option value="TypeError" {% if request.GET.type == "TypeError" %}selected{% endif %}>TypeError</option>
        <option value="ValueError" {% if request.GET.type == "ValueError" %}selected{% endif %}>ValueError</option>
        <option value="NameError" {% if request.GET.type == "NameError" %}selected{% endif %}>NameError</option>
      </select>
    </div>

    <div style="width: 12%;">
      <label class="form-label fw-semibold text-secondary">é–‹å§‹æ—¥</label>
      <input type="date" name="start_date" value="{{ request.GET.start_date }}" class="form-control">
    </div>

    <div style="width: 12%;">
      <label class="form-label fw-semibold text-secondary">çµ‚äº†æ—¥</label>
      <input type="date" name="end_date" value="{{ request.GET.end_date }}" class="form-control">
    </div>

    <div style="width: 20%; display: flex; gap: 4px; align-items: end;">
      <button type="submit" class="btn text-white w-50" style="background-color:#3CA9A9;">æ¤œç´¢</button>
      <a href="{% url 'admin_app:admin_error_logs' %}" class="btn btn-outline-secondary w-50">ã‚¯ãƒªã‚¢</a>
    </div>
  </form>

  <!-- â–¼ è¡¨ç¤ºä»¶æ•°åˆ‡æ›¿ -->
  <div class="text-end mb-2">
    <form method="get" class="d-inline">
      <input type="hidden" name="q" value="{{ query }}">
      <select name="per_page" onchange="this.form.submit()" class="form-select form-select-sm w-auto d-inline">
        <option value="20" {% if request.GET.per_page == '20' or not request.GET.per_page %}selected{% endif %}>20ä»¶</option>
        <option value="50" {% if request.GET.per_page == '50' %}selected{% endif %}>50ä»¶</option>
        <option value="100" {% if request.GET.per_page == '100' %}selected{% endif %}>100ä»¶</option>
      </select>
    </form>
  </div>
  <!-- ======================== -->
  <!-- ğŸ“‹ ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ä¸€è¦§ -->
  <!-- ======================== -->
  {% if logs %}
  <div class="table-responsive">
    <table class="table table-hover align-middle border-top" style="border-color:#b4e4e4;">
      <thead class="table-light">
        <tr class="text-secondary">
          <th style="width:6%;">ID</th>
          <th style="width:8%;">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
          <th style="width:11%;">å¯¾å¿œè€…</th>
          <th style="width:11%;">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</th>
          <th style="width:14%;">ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥</th>
          <th style="width:14%;">ç™ºç”Ÿç®‡æ‰€</th>
          <th style="width:12%;">å†…å®¹</th>
          <th style="width:14%;">ç™ºç”Ÿæ—¥æ™‚</th>
          <th style="width:10%;">æ“ä½œ</th>
        </tr>
      </thead>
        <tbody>
          {% for log in logs %}
          <tr class="{% if log.status == 'resolved' %}resolved-row{% endif %}">
            <td>{{ log.id }}</td>
            <td>
              {% if log.status == "unresolved" %}
                æœªå¯¾å¿œ
              {% elif log.status == "in_progress" %}
                å¯¾å¿œä¸­
              {% elif log.status == "resolved" %}
                å¯¾å¿œæ¸ˆã¿
              {% endif %}
            </td>
            <td>{{ log.handled_by.username|default:"-" }}</td>
            <td>{{ log.user.username|default:"-" }}</td>
            <td>{{ log.type_name|default:"-" }}</td>
            <td>{{ log.source|default:"-" }}</td>
            <td class="text-truncate" style="max-width:300px;">
              {{ log.message|default:"-" }}
            </td>
            <td>{{ log.created_at|date:"Y/m/d H:i" }}</td>
            <td>
              <a href="{% url 'admin_app:admin_error_detail' log.id %}"
                class="btn btn-sm text-white rounded-0"
                style="background-color:#3CA9A9;">
                è©³ç´°
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>

    </table>
  </div>
    {% include "components/pagination.html" with page_obj=page_obj paginator=paginator %}
  {% else %}
  <p class="text-muted mt-3">ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã¯ã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
  {% endif %}
</div>
{% endblock %}
