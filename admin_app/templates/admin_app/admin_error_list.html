{% extends "admin_app/layout-admin.html" %}
{% load static %}

{% block title %}Kaidoki Desse 管理 | エラーログ一覧{% endblock %}

{% block admin_content %}
<div class="container-fluid py-4">
  <h2 class="fw-bold mb-4 text-dark">エラーログ一覧</h2>

  {% if logs %}
  <div class="table-responsive">
    <table class="table align-middle mb-0 border-top" style="border-color: #b4e4e4;">
      <thead class="table-light">
        <tr class="text-secondary">
          <th>発生日時</th>
          <th>ユーザー</th>
          <th>種別</th>
          <th>発生箇所</th>
          <th>詳細</th>
        </tr>
      </thead>
      <tbody>
        {% for log in logs %}
        <tr>
          <td>{{ log.occurred_at|date:"Y/m/d H:i" }}</td>
          <td>{{ log.user.username|default:"（匿名）" }}</td>
          <td>{{ log.type }}</td>
          <td>{{ log.source }}</td>
          <td class="text-truncate" style="max-width: 420px;">{{ log.detail|truncatechars:80 }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- ページネーション -->
  <nav class="mt-3">
    <ul class="pagination justify-content-center mb-0">
      {% if logs.has_previous %}
      <li class="page-item">
        <a class="page-link text-dark border-0" href="?page={{ logs.previous_page_number }}">前へ</a>
      </li>
      {% endif %}

      <li class="page-item disabled">
        <span class="page-link bg-transparent border-0 text-secondary">
          ページ {{ logs.number }} / {{ logs.paginator.num_pages }}
        </span>
      </li>

      {% if logs.has_next %}
      <li class="page-item">
        <a class="page-link text-dark border-0" href="?page={{ logs.next_page_number }}">次へ</a>
      </li>
      {% endif %}
    </ul>
  </nav>

  {% else %}
  <p class="text-muted mt-3">エラーログはまだ登録されていません。</p>
  {% endif %}
</div>
{% endblock %}
