{% extends "admin_app/layout-admin.html" %}
{% load static %}

{% block title %}Kaidoki Desse ç®¡ç† | é€šçŸ¥ç®¡ç†{% endblock %}

{% block admin_content %}
<div class="container-fluid py-4">
  <h2 class="fw-bold mb-4 text-dark">é€šçŸ¥ç®¡ç†</h2>

  <!-- ğŸ” æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
  <form method="get" class="row g-3 align-items-end mb-4">
    <div class="col-md-4">
      <label class="form-label fw-semibold text-secondary">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
      <input type="text" name="q" value="{{ query }}" class="form-control" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒ»å•†å“åãƒ»å†…å®¹">
    </div>
    <div class="col-md-3">
      <label class="form-label fw-semibold text-secondary">é–‹å§‹æ—¥</label>
      <input type="date" name="start_date" value="{{ start_date }}" class="form-control">
    </div>
    <div class="col-md-3">
      <label class="form-label fw-semibold text-secondary">çµ‚äº†æ—¥</label>
      <input type="date" name="end_date" value="{{ end_date }}" class="form-control">
    </div>
    <div class="col-md-2 text-end">
      <button type="submit" class="btn text-white w-100" style="background-color:#3CA9A9;">æ¤œç´¢</button>
    </div>
  </form>

  <!-- ======================== -->
  <!-- ğŸ“‹ é€šçŸ¥ãƒ­ã‚°ä¸€è¦§ -->
  <!-- ======================== -->
  {% if logs %}
  <div class="table-responsive">
    <table class="table table-hover align-middle border-top" style="border-color:#b4e4e4;">
      <thead class="table-light">
        <tr class="text-secondary">
          <th style="width:5%;">ID</th>
          <th style="width:10%;">ãƒ¦ãƒ¼ã‚¶ãƒ¼</th>
          <th style="width:25%;">å•†å“</th>
          <th style="width:35%;">å†…å®¹</th>
          <th style="width:15%;">æ—¥æ™‚</th>
          <th style="width:5%;">æ—¢èª­</th>
          <th style="width:5%;">æ“ä½œ</th>
        </tr>
      </thead>
      <tbody>
        {% for log in logs %}
        <tr>
          <td>{{ log.id }}</td>
          <td>{{ log.user.username }}</td>
          <td class="text-truncate" style="max-width:220px;">
            {{ log.product.product_name|default:"-" }}
          </td>
          <td class="text-truncate" style="max-width:280px;">
            {% if log.event_type == "stock_low" %}
              åœ¨åº«å¾©æ´»é€šçŸ¥
            {% elif log.event_type == "stock_few" %}
              åœ¨åº«å°‘é€šçŸ¥
            {% elif log.event_type == "threshold_hit" %}
              è²·ã„æ™‚ä¾¡æ ¼ã‚’ä¸‹å›ã‚‹ä¾¡æ ¼æ¤œçŸ¥
            {% elif log.event_type == "lowest_price" %}
              éå»æœ€å®‰å€¤ã‚’æ›´æ–°
            {% elif log.event_type == "discount_over" %}
              æŒ‡å®šå‰²å¼•ç‡ã‚’ä¸‹å›ã‚‹ä¾¡æ ¼æ¤œçŸ¥
            {% else %}
              -
            {% endif %}
          </td>
          <td>{{ log.occurred_at|date:"Y/m/d H:i" }}</td>
          <td>
            {% if log.is_read %}
              <span class="badge border border-dark text-dark rounded-0 bg-white">æ—¢èª­</span>
            {% else %}
              <span class="badge bg-dark rounded-0 text-white">æœªèª­</span>
            {% endif %}
          </td>
          <td>
            <button class="btn btn-sm text-white rounded-0"
                    style="background-color:#3CA9A9;"
                    data-bs-toggle="modal"
                    data-bs-target="#notificationDetailModal{{ log.id }}">
              è©³ç´°
            </button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- â–¼ ãƒ¢ãƒ¼ãƒ€ãƒ«ã¯ãƒ†ãƒ¼ãƒ–ãƒ«ã®å¤–ã§ãƒ«ãƒ¼ãƒ— -->
  {% for log in logs %}
  <div class="modal fade" id="notificationDetailModal{{ log.id }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content border-0 rounded-0">
        <div class="modal-header" style="background-color:#2E5E5E;">
          <h5 class="modal-title fw-bold text-white">é€šçŸ¥è©³ç´°</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="é–‰ã˜ã‚‹"></button>
        </div>
        <div class="modal-body">
          <table class="table table-borderless mb-0">
            <tr>
              <th class="text-secondary" style="width: 25%;">ID</th>
              <td>{{ log.id }}</td>
            </tr>
            <tr>
              <th class="text-secondary">ãƒ¦ãƒ¼ã‚¶ãƒ¼</th>
              <td>{{ log.user.username }}</td>
            </tr>
            <tr>
              <th class="text-secondary">å•†å“</th>
              <td>{{ log.product.product_name|default:"-" }}</td>
            </tr>
            <tr>
              <th class="text-secondary">é€šçŸ¥å†…å®¹</th>
              <td>
                {% if log.event_type == "stock_low" %}
                  åœ¨åº«å¾©æ´»é€šçŸ¥
                {% elif log.event_type == "stock_few" %}
                  åœ¨åº«å°‘é€šçŸ¥
                {% elif log.event_type == "threshold_hit" %}
                  è²·ã„æ™‚ä¾¡æ ¼ã‚’ä¸‹å›ã‚‹ä¾¡æ ¼æ¤œçŸ¥
                {% elif log.event_type == "lowest_price" %}
                  éå»æœ€å®‰å€¤ã‚’æ›´æ–°
                {% elif log.event_type == "discount_over" %}
                  æŒ‡å®šå‰²å¼•ç‡ã‚’ä¸‹å›ã‚‹ä¾¡æ ¼æ¤œçŸ¥
                {% else %}
                  -
                {% endif %}
              </td>
            </tr>
            <tr>
              <th class="text-secondary">é€ä¿¡æ—¥æ™‚</th>
              <td>{{ log.occurred_at|date:"Y/m/d H:i" }}</td>
            </tr>
            <tr>
              <th class="text-secondary">æ—¢èª­çŠ¶æ…‹</th>
              <td>{% if log.is_read %}æ—¢èª­{% else %}æœªèª­{% endif %}</td>
            </tr>
          </table>
        </div>
        <div class="modal-footer bg-light">
          <button type="button" class="btn btn-outline-dark rounded-0" data-bs-dismiss="modal">é–‰ã˜ã‚‹</button>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
    {% include "components/pagination.html" with page_obj=page_obj paginator=paginator %}
  {% else %}
  <p class="text-muted mt-3">é€šçŸ¥ãƒ­ã‚°ã¯ã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
  {% endif %}

</div>
{% endblock %}
